<app-header></app-header>
<ng-container
    [ngTemplateOutlet]="(env$ | async)?.FLAVOR === 'ont' ? ont : rtr"
></ng-container>

<ng-template #ont>
    <main
        *ngIf="result$ | async as result; else noResult"
        class="app-main app-main--ont"
    >
        <app-test-boxes></app-test-boxes>
        <app-test-charts></app-test-charts>
    </main>
</ng-template>

<ng-template #rtr>
    <app-body>
        <app-main-menu></app-main-menu>
        <app-main-content
            *ngIf="result$ | async as result; else noResult"
            [style.flex-direction]="'column'"
        >
            <app-export-warning></app-export-warning>
            <div class="app-main" *transloco="let t">
                <h1 class="app-title">
                    {{ t("Measurement result from") }}
                    {{ result.measurementDate | date }}
                </h1>
                <div class="app-wrapper">
                    <app-table
                        [columns]="columns"
                        [data]="getBasicResults(result)"
                        [sort]="sort"
                    ></app-table>
                </div>
                <div class="app-wrapper app-charts">
                    <div class="app-charts__col">
                        <h2 class="app-title">{{ t("Ping") }}</h2>
                        <app-test-chart phase="ping"></app-test-chart>
                    </div>
                    <div class="app-charts__col">
                        <h2 class="app-title">{{ t("Download") }}</h2>
                        <app-test-chart phase="download"></app-test-chart>
                    </div>
                    <div class="app-charts__col">
                        <h2 class="app-title">{{ t("Upload") }}</h2>
                        <app-test-chart phase="upload"></app-test-chart>
                    </div>
                </div>
                <h2 class="app-title">{{ t("Detailed results") }}</h2>
                <div class="app-wrapper">
                    <app-table
                        [columns]="columns"
                        [data]="getDetailedResults(result)"
                        [sort]="sort"
                    ></app-table>
                </div>
            </div>
            <app-footer></app-footer>
        </app-main-content>
    </app-body>
</ng-template>

<ng-template #noResult>
    <main *ngIf="error$ | async as error" class="app-main">
        Measurement failed. {{ error.message }}
    </main>
    <main *ngIf="(error$ | async) === null" class="app-main">
        Fetching the result...
    </main>
</ng-template>
